<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„Ø¹Ø¨Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† - Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ÙˆØ§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ©</title>
    <style>
        /* ================================================= */
        /* CSS: Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ù…Ø¸Ù‡Ø± */
        /* ================================================= */
        :root {
            --board-cells: 40;
            --cell-size: 10px;
            --board-size: calc(var(--board-cells) * var(--cell-size)); 
            --snake-color: #dd0303; 
            --food-color: #0895e7; 
            --background-color: #333;
            --ui-color: #f0f0f0;
            --primary-button: #00A86B;
            --secondary-button: #FFD700;
        }
       
    
        body {
            font-family: 'Tahoma', sans-serif;
            background-color: var(--background-color);
            color: var(--ui-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        .main-wrapper {
            display: flex;
            gap: 25px;
            background: #222;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.7);
            align-items: flex-start; /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ù„Ø£Ø¹Ù„Ù‰ */
        }
        
        .game-column {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: var(--board-size); /* Ù„ØªØ­Ø¯ÙŠØ¯ Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆØ­Ø© */
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© */
        #game-board {
            width: var(--board-size);
            height: var(--board-size);
            background-color: #444;
            display: grid;
            grid-template-columns: repeat(var(--board-cells), 1fr);
            grid-template-rows: repeat(var(--board-cells), 1fr);
            border: 5px solid var(--snake-color);
            border-radius: 5px;
            position: relative;
        }
        .snake { background-color: var(--snake-color); border-radius: 1px; }
        .food { background-color: var(--food-color); border-radius: 20%; }
        .food.spawned { background-color: #00BFFF; } 

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªØ­ÙƒÙ… */
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #555;
        }
        .score-item { font-size: 1.5em; font-weight: bold; }
        .pause-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .pause-button:hover { background-color: #2980b9; }

        /* Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠØ© ÙˆØ§Ù„ÙˆÙ‚Øª */
        .records-panel {
            display: flex;
            justify-content: space-between;
            background-color: #333;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #555;
            font-size: 1.1em;
        }
        .record-item { color: var(--secondary-button); }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            border-radius: 10px;
            display: none;
        }
        .restart-button {
            margin-top: 20px;
            padding: 12px 25px;
            background-color: var(--primary-button);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            transition: 0.2s;
        }

        /* Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙØªÙˆØ­ (Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ) */
        #shop-container {
            width: 210px; /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„Ù„Ù…ØªØ¬Ø± */
            background-color: #333;
            padding: 5px;
            border-radius: 5px;
            border: 2px solid var(--secondary-button);
        }
        #shop-container h3 {
             color: var(--secondary-button); 
             margin-top: 0; 
             margin-bottom: 15px;
             font-size: 1.4em;
             border-bottom: 1px solid #555;
             padding-bottom: 10px;
             text-align: center;
        }
        #upgrades-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .upgrade-item {
            background-color: #444;
            padding: 10px;
            border-radius: 8px;
            text-align: right;
            border: 2px solid #444;
            transition: box-shadow 0.3s, background-color 0.3s;
        }
        .upgrade-item.ready-to-buy {
            box-shadow: 0 0 10px var(--secondary-button);
            border-color: var(--secondary-button);
            background-color: #555;
        }
        .upgrade-details h4 {
            margin: 0 0 5px 0;
            color: var(--primary-button);
            font-size: 1.1em;
        }
        .buy-button {
            margin-top: 8px;
            width: 100%;
            padding: 8px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }
        .buy-button:disabled {
            background-color: #555;
            color: #aaa;
            cursor: not-allowed;
        }
        #powerup-status { text-align: right; }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <div class="game-column">
            <h1 style="color: var(--primary-button); margin: 0; text-align: center;">Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† Ø§Ù„Ù…ÙØ·ÙˆØ± ğŸ</h1>
            
            <div class="header-controls">
                <span class="score-item">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span id="score">0</span></span>
                <button class="pause-button" id="pause-button" onclick="togglePause()">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª (A/Space)</button>
            </div>
            
            <div class="records-panel">
                <span class="record-item">Ø£Ù„Ø³ÙƒÙˆØ±: <span id="high-score">0</span></span>
                <span class="record-item">Ø§Ù„ÙˆÙ‚Øª: <span id="time-score">00:00</span></span>
            </div>
            
            <div id="game-board">
                <div id="game-over-overlay" class="overlay">
                    <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h2>
                    <p>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="final-score">0</span></p>
                    <p>Ù…Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨: <span id="final-time">00:00</span></p>
                    <button class="restart-button" onclick="initGame()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</button>
                </div>
            </div>
            <div id="powerup-status" style="display: none;"></div>
        </div>
        
        <div id="shop-container">
            <h3>Ù…ØªØ¬Ø± Ø§Ù„Ù‚ÙˆÙ‰ Ø§Ù„Ù†Ø´Ø·Ø©</h3>
            <div id="upgrades-list">
                </div>
        </div>
    </div>

    <script>
        // =================================================================
        // JAVASCRIPT: Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø©
        // =================================================================

        const BOARD_SIZE = 40;
        const INITIAL_SPEED = 150; 
        const POINTS_PER_FOOD = 3; 
        const MAGNET_RANGE = 5; 
        const TAIL_BOMB_LENGTH = 4; 
        
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        const powerupStatus = document.getElementById('powerup-status');
        const gameOverOverlay = document.getElementById('game-over-overlay');
        const pauseButton = document.getElementById('pause-button');
        const highScoreDisplay = document.getElementById('high-score');
        const timeScoreDisplay = document.getElementById('time-score');

        let snake;
        let foodItems; 
        let direction;
        let nextDirection; 
        let gameLoopInterval;
        let gameSpeed;
        let score;
        let cumulativeScore; // Ù„ØªØªØ¨Ø¹ Ø§Ù„Ø³ÙƒÙˆØ± Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†ÙØ§Ù‚ (Ø£Ø¹Ù„Ù‰ Ø³ÙƒÙˆØ±)
        let gameActive = false;
        let isPaused = false;
        
        // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·ÙˆÙŠØ±Ø§Øª Ø§Ù„Ù‚ÙˆÙŠØ©
        let isInvincible = false;
        let isMagnetActive = false;
        let invincibilityTimer;
        let magnetTimer;
        let baseGameSpeed = INITIAL_SPEED;

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ù€ High Score
        let timerInterval;
        let startTime;
        let high_score = localStorage.getItem('snake_high_score') ? parseInt(localStorage.getItem('snake_high_score')) : 0;
        
        // ØªØ·ÙˆÙŠØ±Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±
        let POWERUPS = {
            magnet: { name: "Ø¬Ø°Ø¨ Ø§Ù„Ø·Ø¹Ø§Ù… ğŸ§²", desc: "Ø¬Ø°Ø¨ Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„Ù‚Ø±ÙŠØ¨ (5 Ø«ÙˆØ§Ù†Ù)", cost: 10, duration: 5000, active: false },
            invincibility: { name: "Ø­ØµØ§Ù†Ø© Ù…Ø¤Ù‚ØªØ© â­", desc: "Ø­ØµØ§Ù†Ø© Ø¶Ø¯ Ø§Ù„Ø°ÙŠÙ„ (60 Ø«Ø§Ù†ÙŠØ©)", cost: 15, duration: 60000, active: false },
            spawn: { name: "Ø®Ù„Ù‚ Ø§Ù„Ø·Ø¹Ø§Ù… ğŸ", desc: "ÙŠØ¶ÙŠÙ ÙƒØ±Ø© Ø·Ø¹Ø§Ù… Ø¥Ø¶Ø§ÙÙŠØ©", cost: 12 },
            bomb: { name: "ØªÙØ¬ÙŠØ± Ø§Ù„Ø°ÙŠÙ„ ğŸ’¥", desc: `ØªÙ‚ØµÙŠØ± Ø§Ù„Ø«Ø¹Ø¨Ø§Ù† Ø¥Ù„Ù‰ ${TAIL_BOMB_LENGTH} Ù‚Ø·Ø¹`, cost: 20 }
        };

        // ============================
        // I. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        // ============================
        
        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function updateTimer() {
            if (isPaused || !gameActive) return;
            const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
            timeScoreDisplay.textContent = formatTime(elapsedSeconds);
        }

        function initGame() {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§Ù„Ø©
            clearInterval(timerInterval);
            clearTimeout(invincibilityTimer);
            clearTimeout(magnetTimer);
            isInvincible = false;
            isMagnetActive = false;
            powerupStatus.style.display = 'none';

            gameOverOverlay.style.display = 'none';
            gameActive = true;
            isPaused = false;
            pauseButton.textContent = "Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª (A/Space)";

            score = 0;
            cumulativeScore = 0; 
            scoreDisplay.textContent = score;
            highScoreDisplay.textContent = high_score;
            baseGameSpeed = INITIAL_SPEED;
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†
            snake = [{ x: Math.floor(BOARD_SIZE / 2), y: Math.floor(BOARD_SIZE / 2) }];
            direction = { x: 1, y: 0 }; 
            nextDirection = { x: 1, y: 0 };
            snake.push({ x: snake[0].x - 1, y: snake[0].y });
            snake.push({ x: snake[0].x - 2, y: snake[0].y });

            foodItems = [];
            placeFood(false); 
            drawGame();
            renderShop();
            updateGameInterval(baseGameSpeed);

            // Ø¨Ø¯Ø¡ Ù…Ø¤Ù‚Øª Ø§Ù„ÙˆÙ‚Øª
            startTime = Date.now();
            timeScoreDisplay.textContent = "00:00";
            timerInterval = setInterval(updateTimer, 1000);
        }
        
        function updateGameInterval(newSpeed) {
            clearInterval(gameLoopInterval);
            gameSpeed = newSpeed;
            gameLoopInterval = setInterval(gameLoop, gameSpeed);
        }

        function gameLoop() {
            if (isPaused) return;

            // 1. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø°Ø¨ Ø§Ù„Ù…ØºÙ†Ø§Ø·ÙŠØ³ÙŠ
            if (isMagnetActive) {
                const head = snake[0];
                foodItems.forEach(food => {
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©
                    const dx = food.x - head.x;
                    const dy = food.y - head.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance <= MAGNET_RANGE) {
                        // Ø³Ø­Ø¨ Ø§Ù„Ø·Ø¹Ø§Ù… Ø¨Ø¨Ø·Ø¡ Ù†Ø­Ùˆ Ø±Ø£Ø³ Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†
                        if (Math.abs(dx) > 0) food.x += (dx > 0 ? -1 : 1); 
                        if (Math.abs(dy) > 0) food.y += (dy > 0 ? -1 : 1);
                    }
                });
            }

            // 2. Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©
            direction = nextDirection;
            let head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

            // Ø¹Ø¨ÙˆØ± Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†
            if (head.x < 0) head.x = BOARD_SIZE - 1;
            else if (head.x >= BOARD_SIZE) head.x = 0;
            else if (head.y < 0) head.y = BOARD_SIZE - 1;
            else if (head.y >= BOARD_SIZE) head.y = 0;

            // ÙØ­Øµ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
            if (checkCollision(head) && !isInvincible) {
                gameOver();
                return;
            }

            // Ø¥Ø¶Ø§ÙØ© Ø±Ø£Ø³ Ø¬Ø¯ÙŠØ¯
            snake.unshift(head);

            // 3. ÙØ­Øµ Ø§Ù„Ø£ÙƒÙ„
            let foodEatenIndex = foodItems.findIndex(food => head.x === food.x && head.y === food.y);
            
            if (foodEatenIndex !== -1) {
                score += POINTS_PER_FOOD; 
                cumulativeScore += POINTS_PER_FOOD; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³ÙƒÙˆØ± Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
                scoreDisplay.textContent = score;
                renderShop(); 
                
                foodItems.splice(foodEatenIndex, 1);
                if (foodItems.length === 0) {
                     placeFood(false); 
                }

                // ØªØ­Ø¯ÙŠØ« Ø£Ø¹Ù„Ù‰ Ø³ÙƒÙˆØ±
                if (cumulativeScore > high_score) {
                    high_score = cumulativeScore;
                    localStorage.setItem('snake_high_score', high_score);
                    highScoreDisplay.textContent = high_score;
                }

                // ØªØ³Ø±ÙŠØ¹ Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹
                if (baseGameSpeed > 50) {
                    baseGameSpeed -= 2; 
                    updateGameInterval(baseGameSpeed);
                }
            } else {
                snake.pop();
            }

            drawGame();
        }

        function checkCollision(head) {
            for (let i = 1; i < snake.length; i++) {
                if (snake[i].x === head.x && snake[i].y === head.y) {
                    return true;
                }
            }
            return false;
        }

        function placeFood(isSpawned) {
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * BOARD_SIZE),
                    y: Math.floor(Math.random() * BOARD_SIZE),
                    isSpawned: isSpawned || false
                };
            } while (snake.some(segment => segment.x === newFood.x && segment.y === newFood.y) || foodItems.some(f => f.x === newFood.x && f.y === newFood.y));
            
            foodItems.push(newFood);
        }

        function drawGame() {
            gameBoard.innerHTML = '';
            // Ø±Ø³Ù… Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†
            snake.forEach(segment => {
                const snakeElement = document.createElement('div');
                snakeElement.style.gridRowStart = segment.y + 1;
                snakeElement.style.gridColumnStart = segment.x + 1;
                snakeElement.classList.add('snake');
                if (isInvincible) { snakeElement.style.opacity = '0.5'; }
                gameBoard.appendChild(snakeElement);
            });

            // Ø±Ø³Ù… ÙƒØ±Ø§Øª Ø§Ù„Ø·Ø¹Ø§Ù…
            foodItems.forEach(food => {
                const foodElement = document.createElement('div');
                foodElement.style.gridRowStart = food.y + 1;
                foodElement.style.gridColumnStart = food.x + 1;
                foodElement.classList.add('food');
                if (food.isSpawned) { foodElement.classList.add('spawned'); }
                gameBoard.appendChild(foodElement);
            });
        }

        function gameOver() {
            clearInterval(gameLoopInterval);
            clearInterval(timerInterval); 
            gameActive = false;

            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-time').textContent = timeScoreDisplay.textContent;
            gameOverOverlay.style.display = 'flex';
        }

        function togglePause() {
            if (!gameActive) return;
            isPaused = !isPaused;
            if (isPaused) {
                pauseButton.textContent = "ØªØ´ØºÙŠÙ„ (A/Space)";
                clearInterval(gameLoopInterval);
                clearInterval(timerInterval); 
            } else {
                pauseButton.textContent = "Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª (A/Space)";
                updateGameInterval(gameSpeed);
                // Ø§Ø³ØªØ¦Ù†Ø§Ù Ù…Ø¤Ù‚Øª Ø§Ù„ÙˆÙ‚Øª
                startTime = Date.now() - (Date.now() - startTime) + (Date.now() - startTime) % 1000;
                timerInterval = setInterval(updateTimer, 1000);
            }
        }


        // ============================
        // II. Ø§Ù„ØªØ­ÙƒÙ… (Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø±) + Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª
        // ============================

        document.addEventListener('keydown', e => {
            // Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¥ØªØ¬Ø§Ù‡Ø§Øª
            if (gameActive && !isPaused) {
                let newDirection = { x: direction.x, y: direction.y }; 
                switch (e.key) {
                    case 'ArrowUp':
                        if (direction.y === 1) return; newDirection = { x: 0, y: -1 }; break;
                    case 'ArrowDown':
                        if (direction.y === -1) return; newDirection = { x: 0, y: 1 }; break;
                    case 'ArrowLeft':
                        if (direction.x === -1) return; newDirection = { x: 1, y: 0 }; break; // Ù…Ø¹ÙƒÙˆØ³
                    case 'ArrowRight':
                        if (direction.x === 1) return; newDirection = { x: -1, y: 0 }; break; // Ù…Ø¹ÙƒÙˆØ³
                }
                nextDirection = newDirection;
            }
            
            // Ø²Ø± Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ù‚Øª (A Ø£Ùˆ Ø§Ù„Ù…Ø³Ø§ÙØ©)
            if (e.key === 'a' || e.key === 'A' || e.key === ' ') {
                togglePause();
                e.preventDefault(); // Ù…Ù†Ø¹ ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ©
            }
        });

        // ============================
        // III. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ÙØªÙˆØ­
        // ============================

        function renderShop() {
            const upgradesList = document.getElementById('upgrades-list');
            upgradesList.innerHTML = '';

            for (const key in POWERUPS) {
                const powerup = POWERUPS[key];
                const item = document.createElement('div');
                item.classList.add('upgrade-item');
                
                const isAvailable = score >= powerup.cost;
                const isActive = powerup.active;

                if (isAvailable && !isActive) {
                    item.classList.add('ready-to-buy');
                } else {
                    item.classList.remove('ready-to-buy');
                }
                
                item.innerHTML = `
                    <div class="upgrade-details">
                        <h4>${powerup.name}</h4>
                        <p style="font-size: 0.9em; color: #ccc;">${powerup.desc}</p>
                        <p style="font-weight: bold;">Ø§Ù„ØªÙƒÙ„ÙØ©: ${powerup.cost} Ù†Ù‚Ø·Ø©</p>
                    </div>
                    <button class="buy-button" 
                        ${!isAvailable || isActive ? 'disabled' : ''} 
                        onclick="buyPowerup('${key}', ${powerup.cost})">
                        ${isActive ? 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…' : 'Ø´Ø±Ø§Ø¡ ÙˆØªÙØ¹ÙŠÙ„'}
                    </button>
                `;
                
                if (isActive) {
                     item.style.border = '2px dashed #FF6347';
                     item.style.boxShadow = '0 0 10px #FF6347';
                } else {
                     item.style.border = '';
                     item.style.boxShadow = '';
                }

                upgradesList.appendChild(item);
            }
        }

        function buyPowerup(key, cost) {
            const powerup = POWERUPS[key];
            if (score >= cost && (!powerup.active || powerup.active === undefined)) {
                
                if (!isPaused) {
                    togglePause(); 
                }
                
                const confirmBuy = confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø´Ø±Ø§Ø¡ ${powerup.name} Ù…Ù‚Ø§Ø¨Ù„ ${cost} Ù†Ù‚Ø·Ø©ØŸ`);
                
                if (confirmBuy) {
                    score -= cost;
                    scoreDisplay.textContent = score;
                    
                    if (key === 'magnet') {
                        activateMagnet(powerup.duration);
                    } else if (key === 'invincibility') {
                        activateInvincibility(powerup.duration);
                    } else if (key === 'spawn') {
                        placeFood(true); 
                        alert(`ØªÙ… Ø´Ø±Ø§Ø¡ ÙˆØªÙØ¹ÙŠÙ„ ${powerup.name}! Ø¸Ù‡Ø±Øª ÙƒØ±Ø© Ø·Ø¹Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø©.`);
                        togglePause(); 
                    } else if (key === 'bomb') {
                        activateTailBomb(); 
                        alert(`ØªÙ… Ø´Ø±Ø§Ø¡ ÙˆØªÙØ¹ÙŠÙ„ ${powerup.name}! ØªÙ… ØªÙ‚ØµÙŠØ± Ø§Ù„Ø«Ø¹Ø¨Ø§Ù†.`);
                        togglePause(); 
                    }
                    
                    renderShop(); 
                } else {
                    togglePause();
                }
            }
        }
        
        // ============================
        // IV. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‚ÙˆÙ‰
        // ============================

        function activateMagnet(duration) {
            clearTimeout(magnetTimer);
            isMagnetActive = true;
            POWERUPS.magnet.active = true;
            powerupStatus.style.display = 'block';
            powerupStatus.textContent = 'ğŸ§² Ø§Ù„Ø¬Ø°Ø¨ Ù†Ø´Ø· (5 Ø«ÙˆØ§Ù†Ù)...';
            togglePause(); 

            magnetTimer = setTimeout(() => {
                isMagnetActive = false;
                POWERUPS.magnet.active = false;
                powerupStatus.style.display = 'none';
                renderShop();
                alert('Ø§Ù†ØªÙ‡Ù‰ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¬Ø°Ø¨!');
            }, duration);
        }

        function activateInvincibility(duration) {
            clearTimeout(invincibilityTimer);
            isInvincible = true;
            POWERUPS.invincibility.active = true;
            powerupStatus.style.display = 'block';
            powerupStatus.textContent = 'â­ Ø§Ù„Ø­ØµØ§Ù†Ø© Ù†Ø´Ø·Ø© (60 Ø«Ø§Ù†ÙŠØ©)...';
            togglePause(); 

            invincibilityTimer = setTimeout(() => {
                isInvincible = false;
                POWERUPS.invincibility.active = false;
                powerupStatus.style.display = 'none';
                renderShop();
                alert('Ø§Ù†ØªÙ‡Ù‰ ØªØ£Ø«ÙŠØ± Ø§Ù„Ø­ØµØ§Ù†Ø©!');
            }, duration);
        }
        
        function activateTailBomb() {
            if (snake.length > TAIL_BOMB_LENGTH) {
                snake.splice(TAIL_BOMB_LENGTH);
                drawGame();
            }
        }


        // ============================
        // V. Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        // ============================

        document.addEventListener('DOMContentLoaded', () => {
            initGame();
        });

    </script>
    <div><h1><a role="button" href=
        "file:///E:/%D9%85%D8%B4%D8%B1%D9%8A%D8%B9%D9%8A/%D8%A3%D9%84%D8%AB%D8%B9%D8%A8%D8%A7%D9%86/game.html">
         <button>
                               Ø£Ø¹Ø§Ø¯Ø© Ø£Ù„ØªØ´ØºÙŠÙ„
         </button>
    </a></h1></div>
</body>
</html>