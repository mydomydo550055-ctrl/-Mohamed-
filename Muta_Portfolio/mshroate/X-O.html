<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ (XO) Ø¨Ù…Ø³ØªÙˆÙŠØ§Øª ØµØ¹ÙˆØ¨Ø©</title>
    <style>
        /* ================================================= */
        /* CSS: Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ù…Ø¸Ù‡Ø± */
        /* ================================================= */
        body {
            font-family: 'Tahoma', sans-serif;
            background-color: #1a1a2e;
            color: #e9e9e9;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            text-align: center;
        }

        h1 {
            color: #ff6a6a;
            margin-bottom: 20px;
        }

        /* Ø­Ø§ÙˆÙŠØ© ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #mode-container {
            margin-bottom: 30px;
            background: #2e2c4f;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµØ¹ÙˆØ¨Ø© (ØªØ¸Ù‡Ø± ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ PVC) */
        #difficulty-selection {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .mode-button, .difficulty-button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: 0.3s;
            background-color: #4a4e69;
            color: #e9e9e9;
            font-weight: bold;
        }

        .mode-button:hover:not(.active), .difficulty-button:hover:not(.active) {
            background-color: #6a6e8f;
        }
        
        .mode-button.active {
            background-color: #ff6a6a;
            color: #1a1a2e;
            box-shadow: 0 0 10px rgba(255, 106, 106, 0.7);
        }

        .difficulty-button.active {
            background-color: #6aff6a; /* Ù„ÙˆÙ† Ù…Ø®ØªÙ„Ù Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„ØµØ¹ÙˆØ¨Ø© */
            color: #1a1a2e;
            box-shadow: 0 0 10px rgba(106, 255, 106, 0.7);
        }
        
        /* Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨ */
        #board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            background-color: #2e2c4f;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .cell {
            width: 100px;
            height: 100px;
            background-color: #4a4e69;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 4em;
            cursor: pointer;
            transition: 0.2s;
            border-radius: 5px;
        }

        .cell:hover {
            background-color: #6a6e8f;
        }
        
        .cell.O { color: #6aff6a; } /* Ù„ÙˆÙ† Ø¯Ø§Ø¦Ø±Ø© */
        .cell.X { color: #ff6a6a; } /* Ù„ÙˆÙ† Ø¥ÙƒØ³ */

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© */
        #status-message {
            margin-top: 20px;
            font-size: 1.8em;
            font-weight: bold;
            height: 40px;
            color: #ffda6a;
        }

        /* Ø²Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ */
        #reset-button {
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            margin-top: 20px;
            background-color: #ff6a6a;
            color: #1a1a2e;
            font-weight: bold;
            transition: 0.3s;
        }
        #reset-button:hover {
            background-color: #ff8c8c;
        }

    </style>
</head>
<body>
    <h1>Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ (X O)</h1>

    <div id="mode-container">
        <div id="mode-selection">
            <button class="mode-button active" id="mode-pvc" onclick="setMode('pvc')">Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ ÙƒÙ…Ø¨ÙŠÙˆØªØ±</button>
            <button class="mode-button" id="mode-pvp" onclick="setMode('pvp')">Ù„Ø§Ø¹Ø¨ Ø¶Ø¯ Ù„Ø§Ø¹Ø¨ (2P)</button>
        </div>
        
        <div id="difficulty-selection">
            <button class="difficulty-button active" data-difficulty="hard" onclick="setDifficulty('hard')">Ù…Ø­ØªØ±Ù</button>
            <button class="difficulty-button" data-difficulty="medium" onclick="setDifficulty('medium')">Ù…ØªÙˆØ³Ø·</button>
            <button class="difficulty-button" data-difficulty="easy" onclick="setDifficulty('easy')">Ø¶Ø¹ÙŠÙ</button>
        </div>
    </div>

    <div id="status-message">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨!</div>

    <div id="board">
        <div class="cell" data-index="0"></div>
        <div class="cell" data-index="1"></div>
        <div class="cell" data-index="2"></div>
        <div class="cell" data-index="3"></div>
        <div class="cell" data-index="4"></div>
        <div class="cell" data-index="5"></div>
        <div class="cell" data-index="6"></div>
        <div class="cell" data-index="7"></div>
        <div class="cell" data-index="8"></div>
    </div>

    <button id="reset-button" onclick="initGame()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù„Ø¹Ø¨Ø©</button>

    <script>
        // =================================================================
        // JAVASCRIPT: Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø©
        // =================================================================

        const cells = document.querySelectorAll('.cell');
        const statusMessage = document.getElementById('status-message');
        const modePVCButton = document.getElementById('mode-pvc');
        const modePVPButton = document.getElementById('mode-pvp');
        const difficultySelection = document.getElementById('difficulty-selection');
        const difficultyButtons = document.querySelectorAll('.difficulty-button');

        let board; // Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„ØªÙŠ ØªÙ…Ø«Ù„ Ø­Ø§Ù„Ø© Ø§Ù„Ù„ÙˆØ­Ø© (9 Ø®Ø§Ù†Ø§Øª)
        let currentPlayer;
        let gameActive;
        let gameMode = 'pvc'; 
        let currentDifficulty = 'hard'; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù‡Ùˆ Ù…Ø­ØªØ±Ù
        
        const AI_PLAYER = 'O'; 
        const HUMAN_PLAYER = 'X'; 
        
        // Ù†Ø³Ø¨ Ø§Ù„Ø®Ø·Ø£ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©
        const DIFFICULTY_MISTAKES = {
            'easy': 0.70,   // 70% ÙØ±ØµØ© Ù„Ù„Ø®Ø·Ø£
            'medium': 0.30, // 30% ÙØ±ØµØ© Ù„Ù„Ø®Ø·Ø£
            'hard': 0.00    // 0% ÙØ±ØµØ© Ù„Ù„Ø®Ø·Ø£ (ÙŠÙ„Ø¹Ø¨ Minimax ÙƒØ§Ù…Ù„)
        };

        const WINNING_COMBOS = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], 
            [0, 3, 6], [1, 4, 7], [2, 5, 8], 
            [0, 4, 8], [2, 4, 6]            
        ];

        // ============================
        // I. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ù„Ø¹Ø¨ ÙˆØ§Ù„ØµØ¹ÙˆØ¨Ø©
        // ============================
        
        function setDifficulty(difficulty) {
            currentDifficulty = difficulty;
            difficultyButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.difficulty-button[data-difficulty="${difficulty}"]`).classList.add('active');
            initGame();
        }

        function setMode(mode) {
            gameMode = mode;
            modePVCButton.classList.remove('active');
            modePVPButton.classList.remove('active');
            
            if (mode === 'pvc') {
                modePVCButton.classList.add('active');
                difficultySelection.style.display = 'flex'; // Ø¥Ø¸Ù‡Ø§Ø± Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø©
            } else {
                modePVPButton.classList.add('active');
                difficultySelection.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØµØ¹ÙˆØ¨Ø©
            }
            initGame(); 
        }
        
        // ============================
        // II. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        // ============================
        
        function initGame() {
            board = Array(9).fill(''); 
            currentPlayer = HUMAN_PLAYER; 
            gameActive = true;
            
            cells.forEach(cell => {
                cell.textContent = '';
                cell.className = 'cell'; 
                cell.removeEventListener('click', handleCellClick);
                cell.addEventListener('click', handleCellClick);
            });
            
            if (gameMode === 'pvc') {
                const difficultyName = document.querySelector(`.difficulty-button[data-difficulty="${currentDifficulty}"]`).textContent;
                statusMessage.textContent = `Ø£Ù†Øª (X) ØªØ¨Ø¯Ø£ Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (${difficultyName}).`;
            } else {
                statusMessage.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ X ÙŠØ¨Ø¯Ø£.`;
            }
        }

        // ============================
        // III. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨
        // ============================

        function handleCellClick(e) {
            const clickedCell = e.target;
            const clickedCellIndex = parseInt(clickedCell.getAttribute('data-index'));

            if (board[clickedCellIndex] !== '' || !gameActive || (gameMode === 'pvc' && currentPlayer === AI_PLAYER)) {
                return;
            }

            makeMove(clickedCell, clickedCellIndex, currentPlayer);
            
            if (gameActive) {
                if (gameMode === 'pvc') {
                    currentPlayer = AI_PLAYER;
                    statusMessage.textContent = 'Ø¯ÙˆØ± Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±...';
                    setTimeout(aiTurn, 500); 
                } else {
                    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                    statusMessage.textContent = `Ø¯ÙˆØ± Ø§Ù„Ù„Ø§Ø¹Ø¨ ${currentPlayer}.`;
                }
            }
        }

        function makeMove(cellElement, index, player) {
            board[index] = player;
            cellElement.textContent = player;
            cellElement.classList.add(player);

            if (checkWin(board, player)) {
                handleResult(player);
                return true;
            }

            if (checkDraw(board)) {
                handleResult('Draw');
                return true;
            }
            return false;
        }

        function checkWin(currentBoard, player) {
            return WINNING_COMBOS.some(combination => {
                return combination.every(index => currentBoard[index] === player);
            });
        }

        function checkDraw(currentBoard) {
            return currentBoard.every(cell => cell !== '');
        }

        function handleResult(winner) {
            gameActive = false;
            if (winner === 'Draw') {
                statusMessage.textContent = 'ØªØ¹Ø§Ø¯Ù„! Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙØ§Ø¦Ø².';
            } else {
                statusMessage.textContent = `Ø§Ù„Ù„Ø§Ø¹Ø¨ ${winner} Ù‡Ùˆ Ø§Ù„ÙØ§Ø¦Ø²! ğŸ†`;
            }
            cells.forEach(cell => cell.removeEventListener('click', handleCellClick));
        }

        // ============================
        // IV. Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Minimax) - Ù…Ø¹ Ø¹Ù†ØµØ± Ø§Ù„Ø®Ø·Ø£
        // ============================

        function getAvailableMoves(currentBoard) {
            return currentBoard.map((cell, index) => cell === '' ? index : null).filter(val => val !== null);
        }

        // Ø¯Ø§Ù„Ø© Minimax (Ù„Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø«Ø§Ù„ÙŠØ©) - Ù„Ù… ØªØªØºÙŠØ±
        function minimax(newBoard, player) {
            const availableMoves = getAvailableMoves(newBoard);

            if (checkWin(newBoard, HUMAN_PLAYER)) return { score: -10 };
            if (checkWin(newBoard, AI_PLAYER)) return { score: 10 };
            if (availableMoves.length === 0) return { score: 0 };

            let moves = [];
            for (let i = 0; i < availableMoves.length; i++) {
                let move = {};
                move.index = availableMoves[i];
                newBoard[availableMoves[i]] = player;

                let result = minimax(newBoard, player === AI_PLAYER ? HUMAN_PLAYER : AI_PLAYER);
                move.score = result.score;

                newBoard[availableMoves[i]] = ''; // Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„Ø­Ø±ÙƒØ©
                moves.push(move);
            }

            // Ø§Ø®ØªÙŠØ§Ø± Ø£ÙØ¶Ù„ Ø­Ø±ÙƒØ©
            let bestMove;
            let bestScore = player === AI_PLAYER ? -10000 : 10000;

            for (let i = 0; i < moves.length; i++) {
                if (player === AI_PLAYER) {
                    if (moves[i].score > bestScore) {
                        bestScore = moves[i].score;
                        bestMove = moves[i];
                    }
                } else {
                    if (moves[i].score < bestScore) {
                        bestScore = moves[i].score;
                        bestMove = moves[i];
                    }
                }
            }
            return bestMove;
        }

        function aiTurn() {
            if (!gameActive || currentPlayer !== AI_PLAYER) return;

            const availableMoves = getAvailableMoves(board);
            let moveIndex;
            const mistakeChance = DIFFICULTY_MISTAKES[currentDifficulty];

            // ** Ù…Ù†Ø·Ù‚ Ø§Ù„Ø®Ø·Ø£ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© **
            if (Math.random() < mistakeChance && availableMoves.length > 0) {
                // Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠØ±ØªÙƒØ¨ Ø®Ø·Ø£ (ÙŠØ®ØªØ§Ø± Ø­Ø±ÙƒØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©)
                const randomIndex = Math.floor(Math.random() * availableMoves.length);
                moveIndex = availableMoves[randomIndex];
                statusMessage.textContent = 'Ø¯ÙˆØ± Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±... (ÙˆÙ‚Ø¹ ÙÙŠ ÙØ®!)';
            } else {
                // Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠÙ„Ø¹Ø¨ Ø¨Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© (Minimax)
                const bestSpot = minimax(board, AI_PLAYER);
                moveIndex = bestSpot.index;
                statusMessage.textContent = 'Ø¯ÙˆØ± Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±...';
            }
            
            const cellElement = cells[moveIndex];

            if (makeMove(cellElement, moveIndex, AI_PLAYER)) {
                return; 
            }

            currentPlayer = HUMAN_PLAYER;
            statusMessage.textContent = `Ø¯ÙˆØ±Ùƒ (X).`;
        }

        // ============================
        // V. Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        // ============================
        
        document.addEventListener('DOMContentLoaded', () => {
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            setMode('pvc');
            setDifficulty('hard');
            initGame();
        });

    </script>
</body>
</html>